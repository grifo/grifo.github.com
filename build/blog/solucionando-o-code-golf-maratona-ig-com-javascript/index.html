<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    
    <title>Solucionando o Code Golf + Maratona IG com Javascript | blog da Grifo</title>
    
    <meta name="viewport" content="width=device-width" />
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta property="og:description" content="Solucionando o Code Golf + Maratona IG com Javascript" />
    <meta property="og:image" content="http://gri.fo/images/fb.png" />
    <meta property="og:url" content="/blog/solucionando-o-code-golf-maratona-ig-com-javascript" />
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png" />
    <link rel="alternate" href="http://gri.fo/blog/atom.xml" title="blog da Grifo" type="application/atom+xml" />
    <link rel="stylesheet" href="/styles/base.css" />
    <link rel="stylesheet" title="GitHub Syntax Highlight" href="/styles/github.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24598886-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</head>

<body class="page">

    <header id="sidebar">
        
        <a href="/blog" class="back">home do blog</a>
        
        <hgroup>
            <h1><a class="logo" href="/" title="página inicial">Grifo</a></h1>
            <p class="sub">Blog de desenvolvimento da Grifo. Técnicas de front-end, node.js, CSS3, HTML5 e design</p>
            <a href="https://twitter.com/grifotecnologia" class="twitter-follow-button" id="twitter-follow-button" data-show-count="false" data-lang="en" data-size="small">Follow @grifotecnologia</a>
            <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Ffacebook.com%2Fgrifotecnologia&amp;send=false&amp;layout=button_count&amp;width=100&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21&amp;appId=326273014110834" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:21px;" allowTransparency="true"></iframe>
        </hgroup>
    </header>
    
    <section id="main">
        <article>
    <header>
        <h2>Solucionando o Code Golf + Maratona IG com Javascript</h2>
        <div class="meta">
            <time datetime="2010-07-27T00:00:00-03:00" pubdate>27 Jul 2010</time>
            <ul class="tags">
                
                <li><a href="/tags/#!code golf">code golf</a></li>
                
                <li><a href="/tags/#!javascript">javascript</a></li>
                
                <li><a href="/tags/#!php">php</a></li>
                
                <li><a href="/tags/#!FISL">FISL</a></li>
                
            </ul>
        </div>
    </header>

    

    <p>Semana passada Porto Alegre recebeu o <a href="http://fisl.softwarelivre.org/">FISL</a>, que reuniu mais de 8 mil pessoas no campus da PUC. Estivemos lá pra conferir as palestras envolvendo HTML5, CSS, Javascript, acessibilidade e novas tecnologias/projetos.</p>

<p>No meio tempo entre trabalho e palestras resolvi participar do <a href="http://ignofisl.ig.com.br/2010/07/21/faq-do-code-golf/">Code Golf</a> do IG: resolver <a href="http://ignofisl.ig.com.br/2010/07/22/problemas-do-code-golf/">os 5 problemas</a> dados com o menor código possível. O ganhador de cada categoria levou um iPod touch. Já que Javascript não era um opção, foi PHP mesmo. Depois de uma disputa acirrada e de ter ficado em segundo lugar até meia hora antes do final, a <a href="http://ignofisl.ig.com.br/2010/07/23/ranking-code-golf/">pontuação</a> foi atualizada e terminei em primeiro!</p>

<p>Neste post vamos ver como ficaram as soluções em PHP, e também em Javascript. Pra isso vamos utilizar o <a href="http://www.jsdb.org/">JSDB</a>, que interpreta Javascript usando a engine <a href="http://www.mozilla.org/js/spidermonkey/">SpiderMonkey</a> da Mozilla e nos dá acesso ao sistema de arquivos, banco de dados e web. Ele roda em Linux, Mac e Windows e não exige instalação: é só baixar, descompactar e começar a usar. Vamos resolver também o problema da <a href="http://ignofisl.ig.com.br/2010/07/22/desafio-maratona-ig/">Maratona IG</a> em menos de 15 minutos usando Javascript.</p>

<blockquote><p>Soluções <a href="#q1">1</a>, <a href="#q2">2</a>, <a href="#q3">3</a>, <a href="#q4">4</a> e <a href="#q5">5</a> do Code Golf</p>

<p><a href="#maratona">Solução da Maratona</a></p></blockquote>

<p>Vamos ao código:</p>

<h2 id="q1">Questão 1</h2>


<p><strong>Dado o número de iterações exibir a sequência de Fibonacci até aquela iteração</strong></p>

<pre><code>entrada: 6
saida: 1, 1, 2, 3, 5, 8
</code></pre>

<h3>PHP</h3>

<p>Esse foi o código final (pra economizar espaço, colocamos tudo dentro de um for loop):</p>

<pre><code>for($a=$c=0,$b=1;$c&lt;$argv[1];$x=$a,$a=$b,$b+=$x)echo(!$c++?'':', ').$b;
</code></pre>

<p>Começamos com 0 e 1 e somamos o último com o anterior até atingir o número de iterações. Em PHP é impossível fazer isso sem utilizar uma terceira variável. A solução mais simples em Javascript é utilizar um array:</p>

<h3>Javascript</h3>

<pre><code>var a = 0
  , b = 1
  , i = 0
  , numeros = [1]

while(++i &lt; jsArguments[0]){
    numeros.push( b=a+(a=b) )
    /* isso é possível porque a variável "a" à esquerda
    da expressão (a=b) continua com o valor antigo,
    o que não acontece no PHP */
}
writeln(o)
// $ ./jsdb q1.js 6 &gt; 1, 1, 2, 3, 5, 8
</code></pre>

<p>Deixando o array – e a legibilidade do código – de lado, o resultado final é um pouco mais compacto:</p>

<pre><code>for(a=c=b=1;c++&lt;=jsArguments[0];print((b=a+(a=b))-a+' '))
</code></pre>

<h2 id="q2">Questão 2</h2>


<p><strong>Dado uma frase retornar se é um palíndrome ou não e listar os caracteres em ordem decrescente de número de incidências na mesma</strong></p>

<pre><code>entrada: “A mala nada na lama”
saída:
  Palíndrome
  8 a
  2 m
  2 n
  2 l
  1 d
</code></pre>

<h3>PHP</h3>

<p>As funções count_chars e strrev tornam o trabalho fácil:</p>

<pre><code>$s=str_replace(' ','',$argv[1]);
echo($s!=strrev($s)?"Não é ":"")."Palíndrome";$c=count_chars($s,1);
arsort($c);foreach($c as $i=&amp;gt;$v)echo"\n$v ".chr($i);
</code></pre>

<h3>Javascript</h3>

<p>Já em Javascript a coisa é mais complicada. O método reverse() só existe para arrays. Temos que fazer a inversão da string e a contagem por nossa conta:</p>

<pre><code>// removemos espaços e outros caracteres da string
var str=jsArguments[0].toLowerCase().replace(/\W/g,'');

// verificamos se o inverso é igual
println( (str!=str.split('').reverse().join('') ? "Não é " : "")+"Palíndrome");

// contamos os caracteres usando um array
var chars = [];
for(var i in str){ // não façam isso em casa
    var key = str[i];
    chars[key] = chars[key]+1 || 1;
}

// exibimos a contagem pra cada letra
for(var n in chars){
    println(chars[n]+" "+n);
}
</code></pre>

<p>E depois transformamos de novo isso tudo em uma linha ininteligível:</p>

<pre><code>s=jsArguments[0].toLowerCase().replace(/\W/g,'');
println((s!=s.split('').reverse().join('')?"Não é ":"")+"Palíndrome");
c=[];for(i in s){k=s[i];c[k]=c[k]+1||1;}for(n in c)println(c[n]+" "+n);
</code></pre>

<h2 id="q3">Questão 3</h2>


<p><strong>Dado um endereço IP e uma máscara de rede, retornar o endereço de broadcast e a conotação CIDR da rede</strong></p>

<pre><code>entrada: 201.94.10.19 255.255.255.0
saída: 201.94.10.255 /24
</code></pre>

<p>Essa é assustadora. Mas depois de consultar a Wikipedia sobre o assunto se descobre que a matemática é simples, e que <a href="http://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDR</a> é uma gambiarra que inventaram pra usar um mesmo IP em mais de uma máquina, em redes internas. Temos que fazer o seguinte:</p>

<ul>
<li>Descobrir o complemento de cada pedaço da subnet mask (255.255.255.0), no caso do exemplo 0.0.0.255</li>
<li>Aplicar o operador <a href="http://en.wikipedia.org/wiki/Bitwise_operation#OR">bitwise OR</a> à cada parte do IP e o complemento da máscara (ex: 255|0)</li>
</ul>


<p>O resultado disso é o endereço de broadcast. Depois, precisamos transformar o IP resultante em binário, e contar quantos bits “1″ ele contém. Essa é a conotação CIDR. Vamos ao código:</p>

<h3>PHP</h3>

<pre><code>$b='';$c=0;$m=explode(".",$argv[2]);
foreach(explode('.',$argv[1]) as $k=&gt;$v){$b.=($k?'.':'').($v|255-$m[$k]);
$c+=substr_count(decbin($m[$k]),1);}echo "$b /$c";
</code></pre>

<h3>Javascript</h3>

<pre><code>var
    cidr = 0,
    ip = jsArguments[0].split('.'),
    mask = jsArguments[1].split('.');

// encontramos o broadcast address
// usando a fórmula descrita
var broadcast = ip.map(function(val,key){
    return val | (255-mask[key]);
}).join('.');

// e calculamos o CIDR por partes
mask.forEach(function(val){
    // primeiro convertemos o valor para Number
    // e depois para string usando base 2 (binário)
    // ex: 252 &gt; 11111100
    // e então contamos quantos "1"s na string
    cidr += (+val).toString(2).split('1').length-1;
});

//saida
writeln(broadcast+" /"+cidr);
</code></pre>

<p>O resultado final é muito mais longo do que em PHP pelas várias chamadas de função, mas ainda pode ser reduzido:</p>

<pre><code>c=0;i=jsArguments[0].split('.');m=jsArguments[1].split('.');
b=i.map(function(v,k){return v|(255-m[k])}).join('.');
m.forEach(function(v){c+=(+v).toString(2).split('1').length-1});
writeln(broadcast+" /"+cidr);
</code></pre>

<h2 id="q4">Questão 4</h2>


<p><strong>Dados dois números naturais m e n e duas sequências ordenadas com m e n números inteiros, obter uma única sequência ordenada contendo todos os elementos das sequências originais sem repetição</strong></p>

<pre><code>entrada: 1,5,6,10,12  2,5,9,29
saída: 1, 2, 5, 6, 9, 10, 12, 29
</code></pre>

<p>Mais uma vez as funções nativas do PHP fazem todo o trabalho. Em Javascript é mais divertido.</p>

<h3>PHP</h3>

<pre><code>$a=array_unique(explode(',',$argv[1].','.$argv[2]));
sort($a);echo implode(',',$a);
</code></pre>

<h3>Javascript</h3>

<pre><code>var
    resultado = [],
    a1 = jsArguments[0].split(',')
    a2 = jsArguments[1].split(','),
    arr = a1.concat(a2);

// inserir valor em unique somente se
// ainda não existe valor igual no array
arr.map(function(val){
    if (resultado.indexOf(+val)&lt;0)
        resultado.push(+val);
})
// pôr em ordem numérica (asc)
resultado = resultado.sort(function(a,b){
    return a&gt;b;
});

writeln(unique);
// saída:
// $ ./jsdb q4.js 1,4,2,5,6 1,2,6,3
// 1, 2, 3, 4, 5, 6
</code></pre>

<p>Podemos pular algumas etapas pra encolher o código:</p>

<pre><code>u=[];a=jsArguments.join().split(',');
a.map(function(v){u.indexOf(+v)&lt;0&amp;&amp;u.push(+v)});
u=u.sort(function(a,b){return a&gt;b});writeln(u);
</code></pre>

<h2 id="q5">Questão 5</h2>


<p><strong>Escreva uma função que recebe uma matriz de caracteres 8×8 representando um tabuleiro de xadrez e calcula o valor total das peças do jogo. Espaços vazios do tabuleiro são codificados como casas com ‘v’ e têm valor 0 (zero). O valor das demais peças é dado de acordo com a tabela: Peão (p): 1, Cavalo (c): 3, Bispo (b): 3, Torre (t): 5, Rainha (a): 10, Rei (r): 50, Vazio: (v)</strong></p>

<pre><code>entrada: 
  tcbarbct
  pppppppp
  vvvvvvvv
  vvvvvvvv
  vvvvvvvv
  vvvvvvvv
  pppppppp
  tcbarbct
saída: 180
</code></pre>

<p>Não se preocupe com a idéia do tabuleiro, só precisamos traduzir o valor de cada caractere válido na string e ignorar o resto. Solução simples: fazer um loop com todos os caracteres e usar como chave pra buscar no array de valores. Em PHP nem isso precisa, a função count_chars() já faz a contagem:</p>

<h3>PHP</h3>

<pre><code>$s=0;$v=Array('p'=&gt;1,'c'=&gt;3,'b'=&gt;3,'t'=&gt;5,'a'=&gt;10,'r'=&gt;50,'v'=&gt;0);
foreach(count_chars(preg_replace('/\W/','',$argv[1]),1) as $c=&gt;$n){
$s+=$v[chr($c)]*$n;};echo$s;
</code></pre>

<h3>Javascript</h3>

<pre><code>var
    valores = { p:1, c:3, b:3, t:5, a:10, r:50 },
    // remover todos os caractere não alfanuméricos
    pecas = jsArguments[0].replace(/\W/g,''),
    pontos = 0;

for(var i in pecas){
    pontos += valores[ pecas[i] ] || 0;
}
writeln(pontos);
</code></pre>

<p>E a versão condensada, usando o método replace() para o loop:</p>

<pre><code>v={p:1,c:3,b:3,t:5,a:10,r:50};p=jsArguments[c=0].replace(/\w/g,function(a){c+=v[a]||0});writeln(c);
</code></pre>

<h2 id="maratona">Maratona IG</h2>


<p>O <a href="http://ignofisl.ig.com.br/2010/07/22/desafio-maratona-ig/">desafio da Maratona</a> era o seguinte: a partir de um arquivo texto de 57Mb contendo tweets em JSON, fazer a contagem dos tweets contendo sentimentos “positivos” ou “negativos”. A contagem com a menor margem de erro vence. O problema maior aqui é deduzir qual o tipo de filtro utilizado como referência.</p>

<p>Uma olhada rápida no arquivo de dados nos mostra que as mensagens variam entre os termos feliz/amo/adoro e triste/odeio. Isso é tudo que precisamos saber, agora basta uma expressão regular. Como a chance de uma das palavras-chave aparecer em qualquer outro lugar do objeto é praticamente nula, nem precisamos interpretar o JSON.</p>

<pre><code>var
    positivo = /feliz|gosto|gostei|amo|amei|adoro|adorei/i,
    negativo = /triste|odeio|odiei/i,
    p = 0,
    n = 0,
    line, tweets;

// carregamos o arquivo como Stream
tweets = new Stream(jsArguments[0], 'rt');
// e lemos linha por linha
while (line = tweets.readLine())
{
    if(negativo.test(line))
        n++;
    else if(positivo.test(line))
        p++;
}

writeln("Tweets Positivos:"+p);
writeln("Tweets Negativos:"+n);
</code></pre>

<p>E temos o resultado:</p>

<pre><code>Tweets Positivos: 35507
Tweets Negativos: 4307
</code></pre>

<p>No <a href="http://ignofisl.ig.com.br/2010/07/24/resultado-da-maratona/">resultado da maratona</a> podemos calcular os números ideais:</p>

<pre><code>Positivos: 35322
Negativos: 4316
</code></pre>

<p>A margem de erro do código acima é de 0.005% e 0.003% (positivos/negativos), e o código foi desenvolvido em menos de 15 minutos. A execução também é muito rápida, leva pouco mais de 5 segundos, e isso com SpiderMonkey que não é das engines JS mais rápidas.</p>

<p>O prêmio que a dupla vencedora levou: <strong>dois iPads</strong>.</p>

<p>Encontrou algum bug no código ou sabe de uma maneira melhor? Também acha que javascript deve ser uma opção nesse tipo de competição? Deixe um comentário abaixo.</p>


    
    
<aside class="author">
    
    <h4>Ricardo Tomasi</h4>
    
    
    <a href="//twitter.com/@ricardobeat" class="twitter">@ricardobeat</a>
    
    
    <img src="//secure.gravatar.com/avatar/47923b1f334d8e3f7a00506ac3c7a636?s=80" width="80" height="80" alt="Ricardo Tomasi">
    
    <p></p>
</aside>

    <footer>
        <span st_url="http://gri.fo/blog/solucionando-o-code-golf-maratona-ig-com-javascript" class="st_facebook_hcount" displayText="Facebook"></span>
        <span st_url="http://gri.fo/blog/solucionando-o-code-golf-maratona-ig-com-javascript" class="st_twitter_hcount" displayText="Tweet"></span>
    </footer>
</article>


<aside class="related">
    <h3>Leia também:</h3>
    <ul class="posts">
    
        <li><a href="/blog/internet-explorer-10-agora-no-windows-7">Internet Explorer 10 agora no Windows 7</a></li>
    
        <li><a href="/blog/eventos-em-javascript">Eventos em Javascript</a></li>
    
        <li><a href="/blog/google-maps-parou-de-funcionar">O Google Maps parou de funcionar em seu site?</a></li>
    
        <li><a href="/blog/code-n-bier-season-finale">Code n' Bier - Season Finale</a></li>
    
        <li><a href="/blog/rsjs-retrospectiva">RSJS 2012 - Retrospectiva</a></li>
    
        <li><a href="/blog/code-n-bier-segunda-edicao">Code n' Bier - Segunda edição</a></li>
    
        <li><a href="/blog/a-maior-conferencia-de-javascript-do-universo">A Maior Conferência de JavaScript do Universo</a></li>
    
        <li><a href="/blog/07-o-javascript-brendan-eich">BrazilJS - O estado do JavaScript por Brendan Eich</a></li>
    
        <li><a href="/blog/06-grunt-benjamin-alman">BrazilJS - Grunt por Benjamin E Alman</a></li>
    
    </ul>
</aside>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'blogdagrifo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

    </section>

    <script src="/scripts/highlight.pack.js"></script>
    <script>
        hljs.tabReplace = '    '
        hljs.initHighlightingOnLoad()
    </script>
    <script src="/scripts/base.js"></script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "ur-52b580d3-a4a0-7663-2c94-4cce560bca24"}); </script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <script>(function(){
        function trackOutbound(){
            window._gaq && _gaq.push ['_trackEvent', 'Outbound Link', this.href]
        }
        var links = document.getElementsByTagName('a')
        for (var i = 0, link; link = links[i]; i++){
            if (~link.href.indexOf(document.domain)) continue;
            if (link.addEventListener) link.addEventListener('mousedown', trackOutbound, null);
            else if (link.attachEvent) link.attachEvent('mousedown', trackOutbound);
        }
    })()
    </script>
</body>
</html>